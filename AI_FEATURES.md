# AIåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ¤– æ–°å¢åŠŸèƒ½æ¦‚è¿°

æœ¬ç³»ç»Ÿç°å·²é›†æˆä»¥ä¸‹é«˜çº§åŠŸèƒ½ï¼š

1. **æ–‡ä»¶ä¸Šä¼ UI** - ç›´æ¥ä»æµè§ˆå™¨ä¸Šä¼ ç—…ç†å›¾åƒ
2. **R2å­˜å‚¨** - ä½¿ç”¨Cloudflare R2å¯¹è±¡å­˜å‚¨å®é™…å›¾åƒæ–‡ä»¶
3. **OpenAI Vision AIåˆ†æ** - è‡ªåŠ¨è¯†åˆ«å’Œæ ‡æ³¨ç»†èƒ

---

## ğŸ“¤ æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½

### åŠŸèƒ½è¯´æ˜

ç”¨æˆ·å¯ä»¥ç›´æ¥ä»æµè§ˆå™¨ä¸Šä¼ ç—…ç†å›¾åƒï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- ä¸Šä¼ æ–‡ä»¶åˆ°Cloudflare R2å­˜å‚¨
- ä¿å­˜å›¾åƒå…ƒæ•°æ®åˆ°D1æ•°æ®åº“
- åœ¨ç•Œé¢ä¸­æ˜¾ç¤ºä¸Šä¼ çš„å›¾åƒ

### ä½¿ç”¨æ­¥éª¤

1. **é€‰æ‹©é¡¹ç›®**
   - åœ¨å·¦ä¾§é¡¹ç›®åˆ—è¡¨ä¸­ç‚¹å‡»é€‰æ‹©ä¸€ä¸ªé¡¹ç›®
   - é¡¹ç›®å¿…é¡»å­˜åœ¨æ‰èƒ½ä¸Šä¼ å›¾åƒ

2. **ç‚¹å‡»ä¸Šä¼ æŒ‰é’®**
   - åœ¨"å›¾åƒåˆ—è¡¨"æ ‡é¢˜æ—è¾¹ï¼Œç‚¹å‡»ç»¿è‰²çš„ ğŸ“¤ ä¸Šä¼ æŒ‰é’®

3. **é€‰æ‹©å›¾åƒæ–‡ä»¶**
   - æµè§ˆå™¨ä¼šå¼¹å‡ºæ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
   - é€‰æ‹©ä½ çš„ç—…ç†å›¾åƒæ–‡ä»¶ï¼ˆJPGã€PNGç­‰æ ¼å¼ï¼‰

4. **ç­‰å¾…ä¸Šä¼ å®Œæˆ**
   - ç³»ç»Ÿä¼šæ˜¾ç¤º"æ­£åœ¨ä¸Šä¼ å›¾åƒ..."æç¤º
   - ä¸Šä¼ æˆåŠŸåæ˜¾ç¤º"å›¾åƒä¸Šä¼ æˆåŠŸï¼"
   - æ–°å›¾åƒä¼šè‡ªåŠ¨å‡ºç°åœ¨å›¾åƒåˆ—è¡¨ä¸­

### æŠ€æœ¯é™åˆ¶

- **æ–‡ä»¶å¤§å°**: æœ€å¤§10MB
- **æ–‡ä»¶æ ¼å¼**: æ”¯æŒæ‰€æœ‰å¸¸è§å›¾åƒæ ¼å¼ï¼ˆJPG, PNG, GIF, BMPç­‰ï¼‰
- **å­˜å‚¨ä½ç½®**: Cloudflare R2å¯¹è±¡å­˜å‚¨

### é”™è¯¯å¤„ç†

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| "è¯·å…ˆé€‰æ‹©é¡¹ç›®" | æœªé€‰æ‹©é¡¹ç›® | å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªé¡¹ç›® |
| "è¯·é€‰æ‹©å›¾åƒæ–‡ä»¶" | æ–‡ä»¶ç±»å‹ä¸å¯¹ | é€‰æ‹©å›¾åƒæ–‡ä»¶è€Œéå…¶ä»–ç±»å‹ |
| "å›¾åƒæ–‡ä»¶ä¸èƒ½è¶…è¿‡10MB" | æ–‡ä»¶å¤ªå¤§ | å‹ç¼©å›¾åƒæˆ–é€‰æ‹©è¾ƒå°çš„æ–‡ä»¶ |
| "ä¸Šä¼ å¤±è´¥" | ç½‘ç»œæˆ–æœåŠ¡å™¨é”™è¯¯ | æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œé‡è¯• |

---

## ğŸ¤– AIæ™ºèƒ½è¯†åˆ«åŠŸèƒ½

### åŠŸèƒ½è¯´æ˜

ä½¿ç”¨OpenAI Vision APIï¼ˆGPT-4oæ¨¡å‹ï¼‰è‡ªåŠ¨åˆ†æç—…ç†å›¾åƒï¼Œè¯†åˆ«å¹¶æ ‡æ³¨ç»†èƒã€‚ç³»ç»Ÿä¼šï¼š
- è¯†åˆ«6ç§ç»†èƒç±»å‹ï¼ˆæ·‹å·´ç»†èƒã€è‚¿ç˜¤ç»†èƒç­‰ï¼‰
- è‡ªåŠ¨å®šä½ç»†èƒä½ç½®
- è®¡ç®—è¯†åˆ«ç½®ä¿¡åº¦
- æ‰¹é‡åˆ›å»ºæ ‡æ³¨

### ä½¿ç”¨å‰å‡†å¤‡

#### 1. é…ç½®OpenAI APIå¯†é’¥

**æœ¬åœ°å¼€å‘ç¯å¢ƒï¼š**

ç¼–è¾‘ `.dev.vars` æ–‡ä»¶ï¼š
```bash
OPENAI_API_KEY=sk-your-actual-api-key-here
```

**ç”Ÿäº§ç¯å¢ƒï¼ˆCloudflareï¼‰ï¼š**
```bash
wrangler secret put OPENAI_API_KEY
# è¾“å…¥ä½ çš„APIå¯†é’¥
```

#### 2. è·å–OpenAI APIå¯†é’¥

1. è®¿é—® https://platform.openai.com/api-keys
2. ç™»å½•ä½ çš„OpenAIè´¦å·
3. ç‚¹å‡» "Create new secret key"
4. å¤åˆ¶ç”Ÿæˆçš„å¯†é’¥ï¼ˆsk-...å¼€å¤´ï¼‰
5. ä¿å­˜å¯†é’¥åˆ° `.dev.vars` æ–‡ä»¶

### ä½¿ç”¨æ­¥éª¤

1. **é€‰æ‹©å›¾åƒ**
   - ç¡®ä¿å·²ä¸Šä¼ æˆ–é€‰æ‹©äº†ä¸€å¼ å›¾åƒ
   - å›¾åƒä¼šæ˜¾ç¤ºåœ¨ä¸­é—´çš„ç”»å¸ƒåŒºåŸŸ

2. **ç‚¹å‡»AIè¯†åˆ«æŒ‰é’®**
   - åœ¨å³ä¾§é¢æ¿é¡¶éƒ¨ï¼Œç‚¹å‡» "ğŸ¤– AIæ™ºèƒ½è¯†åˆ«" æŒ‰é’®
   - æŒ‰é’®èƒŒæ™¯ä¸ºæ¸å˜ç´«è“è‰²

3. **ç¡®è®¤åˆ†æ**
   - ç³»ç»Ÿä¼šå¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼Œè¯´æ˜æ³¨æ„äº‹é¡¹
   - ç¡®è®¤äº†è§£ä¼šäº§ç”ŸAPIè´¹ç”¨
   - ç‚¹å‡»"ç¡®å®š"å¼€å§‹åˆ†æ

4. **ç­‰å¾…åˆ†æå®Œæˆ**
   - æŒ‰é’®ä¼šå˜ä¸º"AIåˆ†æä¸­..."å¹¶æ˜¾ç¤ºæ—‹è½¬å›¾æ ‡
   - åˆ†æé€šå¸¸éœ€è¦10-30ç§’
   - è¯·è€å¿ƒç­‰å¾…ï¼Œä¸è¦å…³é—­é¡µé¢

5. **æŸ¥çœ‹ç»“æœ**
   - åˆ†æå®Œæˆåæ˜¾ç¤º"AIæˆåŠŸè¯†åˆ« X ä¸ªç»†èƒï¼"
   - æ‰€æœ‰è¯†åˆ«çš„ç»†èƒä¼šè‡ªåŠ¨æ·»åŠ åˆ°æ ‡æ³¨åˆ—è¡¨
   - ç»Ÿè®¡ä¿¡æ¯ä¼šå®æ—¶æ›´æ–°
   - å¯ä»¥åœ¨ç”»å¸ƒä¸Šçœ‹åˆ°æ‰€æœ‰AIæ ‡æ³¨çš„ç‚¹

### AIè¯†åˆ«èƒ½åŠ›

**å¯è¯†åˆ«çš„ç»†èƒç±»å‹ï¼š**
- ğŸ”µ æ·‹å·´ç»†èƒ (Lymphocyte)
- ğŸ”´ è‚¿ç˜¤ç»†èƒ (Tumor)
- ğŸŸ¢ åŸºè´¨ç»†èƒ (Stromal)
- ğŸŸ  ä¸­æ€§ç²’ç»†èƒ (Neutrophil)
- ğŸŸ£ å—œé…¸æ€§ç²’ç»†èƒ (Eosinophil)
- âš« å…¶ä»– (Other)

**AIåˆ†æç‰¹ç‚¹ï¼š**
- æ¯æ¬¡è¯†åˆ«10-20ä¸ªæœ€æ˜æ˜¾çš„ç»†èƒ
- æä¾›ç½®ä¿¡åº¦åˆ†æ•°ï¼ˆ0-1ï¼‰
- ä½¿ç”¨ç™¾åˆ†æ¯”åæ ‡ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºåƒç´ åæ ‡
- æ‰€æœ‰æ ‡æ³¨æ ‡è®°ä¸º"created_by: model"

### éªŒè¯å’Œä¿®æ­£AIç»“æœ

AIè¯†åˆ«åï¼Œä½ å¯ä»¥ï¼š

1. **æŸ¥çœ‹AIæ ‡æ³¨**
   - åœ¨å³ä¾§æ ‡æ³¨åˆ—è¡¨ä¸­æŸ¥çœ‹æ‰€æœ‰AIæ ‡æ³¨
   - AIæ ‡æ³¨ä¼šæ˜¾ç¤ºç½®ä¿¡åº¦åˆ†æ•°

2. **åˆ é™¤é”™è¯¯æ ‡æ³¨**
   - åˆ‡æ¢åˆ°åˆ é™¤å·¥å…·ï¼ˆğŸ—‘ï¸ï¼‰
   - ç‚¹å‡»é”™è¯¯çš„æ ‡æ³¨å³å¯åˆ é™¤

3. **è¡¥å……é—æ¼çš„ç»†èƒ**
   - ä½¿ç”¨ç‚¹æ ‡æ³¨å·¥å…·ï¼ˆğŸ”µï¼‰æ‰‹åŠ¨æ·»åŠ AIé—æ¼çš„ç»†èƒ
   - æˆ–ä½¿ç”¨å¤šè¾¹å½¢å·¥å…·ï¼ˆğŸŸ£ï¼‰ç²¾ç¡®å‹¾ç”»

4. **ä¿®æ”¹æ ‡ç­¾**
   - ç›®å‰éœ€è¦åˆ é™¤åé‡æ–°æ ‡æ³¨
   - æœªæ¥ç‰ˆæœ¬ä¼šæ·»åŠ ç›´æ¥ç¼–è¾‘åŠŸèƒ½

### è´¹ç”¨è¯´æ˜

**OpenAI APIè´¹ç”¨ï¼ˆGPT-4oæ¨¡å‹ï¼‰ï¼š**
- **è¾“å…¥**: çº¦$2.50 / 1M tokens
- **è¾“å‡º**: çº¦$10.00 / 1M tokens
- **å•æ¬¡åˆ†æé¢„ä¼°**: $0.01 - $0.05ï¼ˆå–å†³äºå›¾åƒå¤§å°ï¼‰

**æˆæœ¬ä¼˜åŒ–å»ºè®®ï¼š**
1. å‹ç¼©å›¾åƒåˆ°åˆé€‚å¤§å°ï¼ˆ1024x1024å·¦å³ï¼‰
2. åªå¯¹å…³é”®å›¾åƒä½¿ç”¨AIåˆ†æ
3. è®¾ç½®APIä½¿ç”¨é™é¢
4. ç›‘æ§OpenAIè´¦æˆ·ç”¨é‡

### é”™è¯¯å¤„ç†

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| "è¯·å…ˆé€‰æ‹©å›¾åƒ" | æœªé€‰æ‹©å›¾åƒ | å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€å¼ å›¾åƒ |
| "è¯·å…ˆé…ç½®OpenAI APIå¯†é’¥" | APIå¯†é’¥æœªè®¾ç½® | åœ¨.dev.varsä¸­é…ç½®OPENAI_API_KEY |
| "OpenAI API error: 401" | APIå¯†é’¥æ— æ•ˆ | æ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡® |
| "OpenAI API error: 429" | APIé…é¢ç”¨å°½æˆ–è¯·æ±‚è¿‡å¿« | ç­‰å¾…åé‡è¯•æˆ–å……å€¼è´¦æˆ· |
| "Failed to parse AI response" | AIè¿”å›æ ¼å¼å¼‚å¸¸ | é‡è¯•åˆ†æ |
| "Image file not found" | R2ä¸­æ‰¾ä¸åˆ°å›¾åƒ | ç¡®è®¤å›¾åƒå·²ä¸Šä¼ åˆ°R2 |

### æŠ€æœ¯ç»†èŠ‚

#### APIè¯·æ±‚æ ¼å¼

```javascript
POST /api/images/:imageId/analyze

// å“åº”ç¤ºä¾‹
{
  "success": true,
  "data": {
    "detected_count": 15,
    "annotations": [
      {
        "id": 123,
        "annotation_type": "point",
        "label": "lymphocyte",
        "coordinates": "[{\"x\":512,\"y\":768}]",
        "confidence": 0.92,
        "created_by": "model"
      }
    ]
  },
  "message": "AI detected 15 cells"
}
```

#### OpenAI Vision APIæç¤ºè¯

ç³»ç»Ÿä½¿ç”¨ä»¥ä¸‹æç¤ºè¯æŒ‡å¯¼AIåˆ†æï¼š

```
Analyze this pathology image and identify cells. For each cell you detect, provide:
1. Cell type (lymphocyte, tumor, stromal, neutrophil, eosinophil, or other)
2. Approximate center coordinates as percentage of image dimensions (x%, y%)
3. Confidence score (0-1)

Please respond ONLY with a valid JSON array in this exact format:
[
  {"type": "lymphocyte", "x": 25.5, "y": 30.2, "confidence": 0.92},
  {"type": "tumor", "x": 45.3, "y": 55.8, "confidence": 0.88}
]

Identify 10-20 most prominent cells. Use percentage coordinates (0-100%).
```

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### åœºæ™¯ï¼šä½¿ç”¨AIå¿«é€Ÿæ ‡æ³¨æ–°å›¾åƒ

**ç¬¬1æ­¥ï¼šä¸Šä¼ å›¾åƒ**
```
1. é€‰æ‹©é¡¹ç›®
2. ç‚¹å‡»ä¸Šä¼ æŒ‰é’®
3. é€‰æ‹©ç—…ç†å›¾åƒæ–‡ä»¶
4. ç­‰å¾…ä¸Šä¼ å®Œæˆ
```

**ç¬¬2æ­¥ï¼šAIåˆ†æ**
```
1. åœ¨å›¾åƒåˆ—è¡¨ä¸­ç‚¹å‡»æ–°ä¸Šä¼ çš„å›¾åƒ
2. ç‚¹å‡»"AIæ™ºèƒ½è¯†åˆ«"æŒ‰é’®
3. ç¡®è®¤åˆ†æ
4. ç­‰å¾…10-30ç§’
```

**ç¬¬3æ­¥ï¼šéªŒè¯å’Œä¿®æ­£**
```
1. æŸ¥çœ‹AIæ ‡æ³¨ç»“æœ
2. ä½¿ç”¨åˆ é™¤å·¥å…·åˆ é™¤é”™è¯¯æ ‡æ³¨
3. ä½¿ç”¨ç‚¹å·¥å…·è¡¥å……é—æ¼çš„ç»†èƒ
4. æ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯æ˜¯å¦åˆç†
```

**ç¬¬4æ­¥ï¼šå¯¼å‡ºæ•°æ®**
```
1. ç‚¹å‡»"å¯¼å‡ºæ•°æ®"æŒ‰é’®
2. ä¸‹è½½JSONæ–‡ä»¶
3. æ–‡ä»¶åŒ…å«æ‰€æœ‰æ ‡æ³¨ï¼ˆAI+æ‰‹åŠ¨ï¼‰
```

---

## âš™ï¸ é…ç½®æŒ‡å—

### æœ¬åœ°å¼€å‘é…ç½®

**1. åˆ›å»º `.dev.vars` æ–‡ä»¶ï¼š**
```bash
cd /home/user/webapp
cat > .dev.vars << 'EOF'
# OpenAI API Key for local development
OPENAI_API_KEY=sk-your-api-key-here
EOF
```

**2. æµ‹è¯•é…ç½®ï¼š**
```bash
# é‡å¯æœåŠ¡
pm2 restart pathology-annotation

# æµ‹è¯•AIåŠŸèƒ½
# åœ¨æµè§ˆå™¨ä¸­ä¸Šä¼ å›¾åƒå¹¶ç‚¹å‡»AIè¯†åˆ«
```

### ç”Ÿäº§ç¯å¢ƒé…ç½®

**1. è®¾ç½®Cloudflare Secretsï¼š**
```bash
cd /home/user/webapp

# è®¾ç½®OpenAI APIå¯†é’¥
wrangler secret put OPENAI_API_KEY

# è¾“å…¥å¯†é’¥åæŒ‰Enter
```

**2. éªŒè¯é…ç½®ï¼š**
```bash
# åˆ—å‡ºæ‰€æœ‰secrets
wrangler secret list --project-name pathology-annotation
```

**3. éƒ¨ç½²ï¼š**
```bash
npm run deploy:prod
```

### R2å­˜å‚¨é…ç½®

**æœ¬åœ°å¼€å‘ï¼š**
- æœ¬åœ°å¼€å‘ä½¿ç”¨Wranglerçš„æœ¬åœ°R2æ¨¡æ‹Ÿ
- æ— éœ€é¢å¤–é…ç½®

**ç”Ÿäº§ç¯å¢ƒï¼š**
```bash
# 1. åˆ›å»ºR2 bucket
wrangler r2 bucket create pathology-images

# 2. æ›´æ–°wrangler.jsoncï¼ˆå·²é…ç½®ï¼‰
# r2_buckets: [{ binding: "IMAGES", bucket_name: "pathology-images" }]

# 3. éƒ¨ç½²
npm run deploy:prod
```

---

## ğŸ“Š æ€§èƒ½å’Œé™åˆ¶

### ä¸Šä¼ é™åˆ¶
- å•æ–‡ä»¶æœ€å¤§ï¼š10MB
- å¹¶å‘ä¸Šä¼ ï¼š1æ¬¡1ä¸ªæ–‡ä»¶
- æ”¯æŒæ ¼å¼ï¼šæ‰€æœ‰å›¾åƒæ ¼å¼

### AIåˆ†æé™åˆ¶
- å•æ¬¡è¯†åˆ«ï¼š10-20ä¸ªç»†èƒ
- å¤„ç†æ—¶é—´ï¼š10-30ç§’
- å›¾åƒå¤§å°ï¼šå»ºè®®ä¸è¶…è¿‡2048x2048

### R2å­˜å‚¨é™åˆ¶
- Cloudflare R2å…è´¹é¢åº¦ï¼š
  - å­˜å‚¨ï¼š10GB
  - Class Aæ“ä½œï¼š100ä¸‡æ¬¡/æœˆ
  - Class Bæ“ä½œï¼š1000ä¸‡æ¬¡/æœˆ

### OpenAI APIé™åˆ¶
- è¯·æ±‚é¢‘ç‡ï¼šæ ¹æ®è´¦æˆ·ç­‰çº§
- Tokené™åˆ¶ï¼šGPT-4oå•æ¬¡æœ€å¤š128k tokens
- å›¾åƒå¤§å°ï¼šæœ€å¤§20MB

---

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šä¸Šä¼ æŒ‰é’®ä¸å¯ç”¨

**ç—‡çŠ¶**: ä¸Šä¼ æŒ‰é’®æ˜¾ç¤ºä½†ç‚¹å‡»æ— ååº”

**å¯èƒ½åŸå› **:
- æœªé€‰æ‹©é¡¹ç›®

**è§£å†³æ–¹æ¡ˆ**:
1. å…ˆåœ¨å·¦ä¾§é€‰æ‹©ä¸€ä¸ªé¡¹ç›®
2. ç¡®è®¤é¡¹ç›®é«˜äº®æ˜¾ç¤º
3. å†ç‚¹å‡»ä¸Šä¼ æŒ‰é’®

### é—®é¢˜2ï¼šä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶**: æ˜¾ç¤º"ä¸Šä¼ å¤±è´¥"é”™è¯¯

**å¯èƒ½åŸå› **:
- æ–‡ä»¶è¿‡å¤§
- R2æœªé…ç½®
- ç½‘ç»œé—®é¢˜

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥æ–‡ä»¶å¤§å°
# ç¡®ä¿ < 10MB

# 2. æ£€æŸ¥R2é…ç½®
pm2 logs pathology-annotation --nostream | grep R2

# 3. é‡å¯æœåŠ¡
pm2 restart pathology-annotation
```

### é—®é¢˜3ï¼šAIè¯†åˆ«å¤±è´¥

**ç—‡çŠ¶**: æ˜¾ç¤º"è¯·å…ˆé…ç½®OpenAI APIå¯†é’¥"

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥.dev.varsæ–‡ä»¶
cat .dev.vars

# 2. ç¡®è®¤APIå¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆsk-å¼€å¤´ï¼‰
# 3. é‡å¯æœåŠ¡
pm2 restart pathology-annotation

# 4. æŸ¥çœ‹æ—¥å¿—
pm2 logs pathology-annotation --nostream
```

### é—®é¢˜4ï¼šAIè¯†åˆ«å¾ˆæ…¢

**ç—‡çŠ¶**: åˆ†ææ—¶é—´è¶…è¿‡1åˆ†é’Ÿ

**å¯èƒ½åŸå› **:
- å›¾åƒè¿‡å¤§
- OpenAI APIå“åº”æ…¢
- ç½‘ç»œå»¶è¿Ÿ

**è§£å†³æ–¹æ¡ˆ**:
1. å‹ç¼©å›¾åƒåˆ°1024x1024å·¦å³
2. æ£€æŸ¥OpenAI APIçŠ¶æ€ï¼šhttps://status.openai.com
3. ç¨åé‡è¯•

### é—®é¢˜5ï¼šå›¾åƒæ— æ³•æ˜¾ç¤º

**ç—‡çŠ¶**: ä¸Šä¼ åå›¾åƒä¸æ˜¾ç¤ºæˆ–æ˜¾ç¤ºå ä½ç¬¦

**å¯èƒ½åŸå› **:
- R2å­˜å‚¨é…ç½®é—®é¢˜
- å›¾åƒæ ¼å¼ä¸æ”¯æŒ

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ£€æŸ¥R2é…ç½®
cat wrangler.jsonc | grep r2_buckets

# 2. æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
# æŒ‰F12æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·

# 3. é‡æ–°ä¸Šä¼ 
# åˆ é™¤å›¾åƒé‡æ–°ä¸Šä¼ 
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### å›¾åƒå‡†å¤‡
1. **å‹ç¼©å›¾åƒ**: å»ºè®®1024x1024æˆ–2048x2048
2. **æ¸…æ™°åº¦**: ç¡®ä¿ç»†èƒæ¸…æ™°å¯è§
3. **æ ¼å¼**: ä¼˜å…ˆä½¿ç”¨JPGï¼ˆæ–‡ä»¶å°ï¼‰
4. **å‘½å**: ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–‡ä»¶å

### AIä½¿ç”¨ç­–ç•¥
1. **å…ˆAIåäººå·¥**: è®©AIåšç²—æ ‡æ³¨ï¼Œäººå·¥ç²¾ä¿®
2. **æ‰¹é‡å¤„ç†**: åŒç±»å›¾åƒä¸€èµ·å¤„ç†
3. **éªŒè¯ç»“æœ**: æ€»æ˜¯éªŒè¯AIæ ‡æ³¨å‡†ç¡®æ€§
4. **æˆæœ¬æ§åˆ¶**: ç›‘æ§APIä½¿ç”¨é‡

### æ•°æ®ç®¡ç†
1. **å®šæœŸå¯¼å‡º**: åŠæ—¶å¯¼å‡ºæ ‡æ³¨æ•°æ®å¤‡ä»½
2. **ç‰ˆæœ¬ç®¡ç†**: è®°å½•AIæ ‡æ³¨ç‰ˆæœ¬
3. **è´¨é‡æ§åˆ¶**: å»ºç«‹æ ‡æ³¨è´¨é‡æ£€æŸ¥æµç¨‹

---

## ğŸ“š APIæ–‡æ¡£

### ä¸Šä¼ å›¾åƒ
```http
POST /api/projects/:projectId/images/upload
Content-Type: multipart/form-data

Body:
- file: å›¾åƒæ–‡ä»¶
- width: å›¾åƒå®½åº¦
- height: å›¾åƒé«˜åº¦

Response:
{
  "success": true,
  "data": {
    "id": 123,
    "filename": "1732534567-abc123.jpg",
    "original_name": "pathology-slide.jpg",
    "width": 2048,
    "height": 1536,
    "file_size": 524288
  }
}
```

### è·å–å›¾åƒæ–‡ä»¶
```http
GET /api/images/:id/file

Response: 
Image binary data (JPEG/PNG/etc)
```

### AIåˆ†æ
```http
POST /api/images/:imageId/analyze

Response:
{
  "success": true,
  "data": {
    "detected_count": 15,
    "annotations": [...]
  },
  "message": "AI detected 15 cells"
}
```

---

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **APIå¯†é’¥å®‰å…¨**
   - æ°¸è¿œä¸è¦æäº¤.dev.varsåˆ°Git
   - ä½¿ç”¨Cloudflare secretsç®¡ç†ç”Ÿäº§å¯†é’¥
   - å®šæœŸè½®æ¢APIå¯†é’¥

2. **æ•°æ®éšç§**
   - ç¡®è®¤OpenAIéšç§æ”¿ç­–
   - ä¸è¦ä¸Šä¼ åŒ…å«æ‚£è€…éšç§ä¿¡æ¯çš„å›¾åƒ
   - ä½¿ç”¨åŒ¿ååŒ–çš„å›¾åƒ

3. **æˆæœ¬æ§åˆ¶**
   - è®¾ç½®OpenAI APIä½¿ç”¨é™é¢
   - ç›‘æ§æ¯æ—¥/æ¯æœˆè´¹ç”¨
   - ä½¿ç”¨è¾ƒå°çš„å›¾åƒå‡å°‘tokenæ¶ˆè€—

---

## ğŸ“ å­¦ä¹ èµ„æº

- **OpenAI Vision API**: https://platform.openai.com/docs/guides/vision
- **Cloudflare R2**: https://developers.cloudflare.com/r2
- **Cloudflare Workers**: https://developers.cloudflare.com/workers
- **Hono Framework**: https://hono.dev

---

**æœ€åæ›´æ–°**: 2025-11-25  
**ç‰ˆæœ¬**: 2.0.0 (æ–°å¢AIåŠŸèƒ½)
